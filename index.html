<!doctype html>
<html lang="en-GB">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>BookQuest</title>
  <meta name="theme-color" content="#0f0f10" />
  <link rel="manifest" href="./manifest.json" />
  <link rel="stylesheet" href="./style.css" />
  <link rel="preconnect" href="https://accounts.google.com" />
  <link rel="preconnect" href="https://apis.google.com" />
  <link rel="preconnect" href="https://www.googleapis.com" />
</head>
<body>
  <header class="top">
    <h1 class="brand">BookQuest</h1>
    <nav class="tabs" aria-label="Navigation">
      <button class="tabbtn active" data-tab="dashboard" type="button">Dashboard</button>
      <button class="tabbtn" data-tab="books" type="button">Books</button>
      <button class="tabbtn" data-tab="session" type="button">Session</button>
      <button class="tabbtn" data-tab="stats" type="button">Stats</button>
      <button class="tabbtn" data-tab="achievements" type="button">Achievements</button>
      <button class="tabbtn" data-tab="quotes" type="button">Quotes</button>
      <button class="tabbtn" data-tab="sync" type="button">Sync</button>
      <button class="tabbtn" data-tab="history" type="button">History</button>
    </nav>
  </header>

  <main class="wrap">
    <!-- DASHBOARD -->
    <section class="tab active" id="tab-dashboard">
      <div class="grid">
        <section class="card col-8">
          <h2>Dashboard</h2>

          <div class="row">
            <div class="field">
              <label for="rangeSelect">Stats range</label>
              <select id="rangeSelect">
                <option value="7">7 days</option>
                <option value="30" selected>30 days</option>
                <option value="90">3 months</option>
                <option value="180">6 months</option>
                <option value="365">1 year</option>
                <option value="99999">All time</option>
              </select>
            </div>

            <div class="field">
              <label for="storyScope">Story export scope</label>
              <select id="storyScope">
                <option value="book" selected>Active book</option>
                <option value="overall">Overall</option>
              </select>
            </div>
          </div>

          <div class="kpis">
            <div class="kpi">
              <div class="k">Level</div>
              <div class="v" id="level">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="k">XP</div>
              <div class="v" id="xp">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="k">Streak</div>
              <div class="v" id="streak">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="k">Daily quest</div>
              <div class="v" id="dailyQuest">‚Äî</div>
            </div>
          </div>

          <div class="row">
            <button class="btn primary" id="makeStory" type="button">Generate Story PNG</button>
            <button class="btn" id="downloadStory" type="button" disabled>Download Story PNG</button>
            <span class="small" id="storyHint"></span>
          </div>

          <div class="previewRow">
            <img id="storyPreview" class="preview" alt="Story preview" />
            <canvas id="storyCanvas" width="1080" height="1920" class="hidden" aria-hidden="true"></canvas>
          </div>
        </section>

        <section class="card col-4">
          <h2>Active book</h2>
          <div id="activeBookCard" class="activeBookCard"></div>
          <hr class="sep" />
          <div class="row">
            <button class="btn" id="markFinished" type="button">Mark finished</button>
          </div>
          <div class="notice">Finishing is based on reaching total pages (or marking manually).</div>
        </section>

        <section class="card col-12">
          <h2>Overall (in range)</h2>
          <div class="kpis">
            <div class="kpi">
              <div class="k">Books</div>
              <div class="v" id="booksCount">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="k">Finished</div>
              <div class="v" id="booksDone">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="k">Pages</div>
              <div class="v" id="pagesRange">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="k">Minutes</div>
              <div class="v" id="minsRange">‚Äî</div>
            </div>
          </div>
        </section>
      </div>
    </section>

    <!-- BOOKS -->
    <section class="tab" id="tab-books">
      <div class="grid">
        <section class="card col-12">
          <h2>Books</h2>

          <div class="row">
            <div class="field grow">
              <label for="bookSelect">Active book</label>
              <select id="bookSelect"></select>
            </div>
          </div>

          <details open>
            <summary>Add a book</summary>
            <div class="formGrid">
              <div class="field">
                <label for="newTitle">Title</label>
                <input id="newTitle" type="text" placeholder="e.g. Canto 2 (edition X)" />
              </div>

              <div class="field">
                <label for="newAuthor">Author</label>
                <input id="newAuthor" type="text" placeholder="e.g. ..." />
              </div>

              <div class="field">
                <label for="newPublisher">Publisher</label>
                <input id="newPublisher" type="text" placeholder="e.g. ..." />
              </div>

              <div class="field">
                <label for="newEdition">Edition</label>
                <input id="newEdition" type="text" placeholder="e.g. 2nd" />
              </div>

              <div class="field">
                <label for="newTotal">Total pages</label>
                <input id="newTotal" inputmode="numeric" placeholder="e.g. 320" />
              </div>

              <div class="field">
                <label for="newCurrent">Current page</label>
                <input id="newCurrent" inputmode="numeric" placeholder="e.g. 0" />
              </div>

              <div class="field">
                <label for="newCover">Cover image (PNG/JPG/JPEG)</label>
                <input id="newCover" type="file" accept="image/png,image/jpeg,image/jpg" />
              </div>

              <div class="field span2">
                <button class="btn primary" id="addBook" type="button">Add</button>
              </div>
            </div>
          </details>

          <details>
            <summary>Edit active book</summary>
            <div class="formGrid">
              <div class="field">
                <label for="editTitle">Title</label>
                <input id="editTitle" type="text" />
              </div>

              <div class="field">
                <label for="editAuthor">Author</label>
                <input id="editAuthor" type="text" />
              </div>

              <div class="field">
                <label for="editPublisher">Publisher</label>
                <input id="editPublisher" type="text" />
              </div>

              <div class="field">
                <label for="editEdition">Edition</label>
                <input id="editEdition" type="text" />
              </div>

              <div class="field">
                <label for="editTotal">Total pages</label>
                <input id="editTotal" inputmode="numeric" />
              </div>

              <div class="field">
                <label for="editCurrent">Current page</label>
                <input id="editCurrent" inputmode="numeric" />
              </div>

              <div class="field">
                <label for="editCover">Cover image (PNG/JPG/JPEG)</label>
                <input id="editCover" type="file" accept="image/png,image/jpeg,image/jpg" />
              </div>

              <div class="field span2">
                <div class="row">
                  <button class="btn primary" id="saveBook" type="button">Save</button>
                  <button class="btn danger" id="deleteBook" type="button">Delete book</button>
                </div>
              </div>
            </div>
          </details>
        </section>
      </div>
    </section>

    <!-- SESSION -->
    <section class="tab" id="tab-session">
      <div class="grid">
        <section class="card col-8">
          <h2>Session</h2>

          <div class="row">
            <div class="field">
              <label for="mode">Mode</label>
              <select id="mode">
                <option value="sprint" selected>Sprint</option>
                <option value="open">Open</option>
              </select>
            </div>

            <div class="field">
              <label for="sprintMins">Sprint (minutes)</label>
              <input id="sprintMins" inputmode="numeric" value="8" />
            </div>
          </div>

          <div class="row">
            <button class="btn primary" id="start" type="button">Start</button>
            <button class="btn" id="pause" type="button" disabled>Pause</button>
            <button class="btn" id="finish" type="button" disabled>End session</button>
            <button class="btn" id="hyper" type="button" disabled>Keep going</button>
          </div>

          <div class="timer" id="timerBig">00:00</div>
          <div class="notice" id="timerHint"></div>

          <hr class="sep" />

          <div class="row">
            <label class="radio"><input type="radio" name="pagesMode" id="pagesModeRange" checked /> Page range</label>
            <label class="radio"><input type="radio" name="pagesMode" id="pagesModeCount" /> Page count</label>
          </div>

          <div id="rangeInputs" class="row">
            <div class="field">
              <label for="fromPage">From page</label>
              <input id="fromPage" inputmode="numeric" placeholder="Auto" />
            </div>
            <div class="field">
              <label for="toPage">To page (required)</label>
              <input id="toPage" inputmode="numeric" placeholder="e.g. 42" />
            </div>
          </div>

          <div id="countInputs" class="row hidden">
            <div class="field">
              <label for="pagesRead">Pages read</label>
              <input id="pagesRead" inputmode="numeric" placeholder="e.g. 6" />
            </div>
          </div>

          <div class="notice">End session logs automatically and updates current page. Switching tabs won‚Äôt reset the timer.</div>
        </section>

        <section class="card col-4">
          <h2>Active book stats</h2>
          <div class="kpis kpis2">
            <div class="kpi">
              <div class="k">Progress</div>
              <div class="v" id="progress">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="k">Pace</div>
              <div class="v" id="pace">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="k">ETA</div>
              <div class="v" id="eta">‚Äî</div>
            </div>
            <div class="kpi">
              <div class="k">Sessions (range)</div>
              <div class="v" id="sessionsN">‚Äî</div>
            </div>
          </div>
        </section>
      </div>
    </section>

    <!-- STATS -->
    <section class="tab" id="tab-stats">
      <div class="grid">
        <section class="card col-6">
          <h2>Active book charts</h2>
          <div class="chartHeader">
            <div class="small">Pages per day</div>
            <button class="btn" id="dlBookPages" type="button">Download PNG</button>
          </div>
          <canvas id="chartPages" width="900" height="280"></canvas>

          <hr class="sep" />

          <div class="chartHeader">
            <div class="small">Minutes per day</div>
            <button class="btn" id="dlBookMins" type="button">Download PNG</button>
          </div>
          <canvas id="chartMins" width="900" height="280"></canvas>
        </section>

        <section class="card col-6">
          <h2>Overall charts</h2>
          <div class="chartHeader">
            <div class="small">Overall pages per day</div>
            <button class="btn" id="dlAllPages" type="button">Download PNG</button>
          </div>
          <canvas id="chartAllPages" width="900" height="280"></canvas>

          <hr class="sep" />

          <div class="chartHeader">
            <div class="small">Overall minutes per day</div>
            <button class="btn" id="dlAllMins" type="button">Download PNG</button>
          </div>
          <canvas id="chartAllMins" width="900" height="280"></canvas>
        </section>
      </div>
    </section>

    <!-- ACHIEVEMENTS -->
    <section class="tab" id="tab-achievements">
      <div class="grid">
        <section class="card col-6">
          <h2>Unlocked</h2>
          <div class="row">
            <div class="badge"><span>üèÖ</span><span id="achUnlocked">‚Äî</span></div>
          </div>
          <div class="list" id="achUnlockedList"></div>
        </section>

        <section class="card col-6">
          <h2>Next up</h2>
          <div class="notice" id="achNext"></div>
          <div class="list" id="achNextList"></div>
        </section>
      </div>
    </section>

    <!-- QUOTES -->
    <section class="tab" id="tab-quotes">
      <div class="grid">
        <section class="card col-6">
          <h2>Add a quote</h2>
          <div class="field">
            <label for="quoteText">Quote</label>
            <textarea id="quoteText" placeholder="Paste or type the quote"></textarea>
          </div>

          <div class="row">
            <div class="field">
              <label for="quoteAuthor">Quote author</label>
              <input id="quoteAuthor" type="text" placeholder="e.g. the author" />
            </div>
            <div class="field">
              <label for="quotePage">Page</label>
              <input id="quotePage" inputmode="numeric" placeholder="e.g. 42" />
            </div>
          </div>

          <div class="field">
            <label for="quoteImage">Photo (optional)</label>
            <input id="quoteImage" type="file" accept="image/png,image/jpeg,image/jpg" capture="environment" />
          </div>

          <div class="row">
            <button class="btn primary" id="addQuote" type="button">Save quote</button>
            <button class="btn" id="previewQuote" type="button" disabled>Preview PNG</button>
            <button class="btn" id="downloadQuote" type="button" disabled>Download PNG</button>
          </div>

          <div class="previewRow">
            <img id="quotePreview" class="preview" alt="Quote PNG preview" />
            <canvas id="quoteCanvas" width="1080" height="1920" class="hidden" aria-hidden="true"></canvas>
          </div>
        </section>

        <section class="card col-6">
          <h2>Saved quotes (active book)</h2>
          <div class="list" id="quotesList"></div>
        </section>
      </div>
    </section>

    <!-- SYNC -->
    <section class="tab" id="tab-sync">
      <div class="grid">
        <section class="card col-12">
          <h2>Sync</h2>

          <details open>
            <summary>Manual (backup)</summary>
            <div class="row">
              <button class="btn" id="exportBtn" type="button">Export JSON</button>
              <label class="btn" for="importFile">Import JSON</label>
              <input id="importFile" type="file" accept="application/json" class="hidden" />
            </div>
            <div class="notice">Use this to move your progress between devices without signing in.</div>
          </details>

          <details open>
            <summary>Google Drive</summary>
            <div class="notice">Stores progress as a JSON file in your Drive app data folder.</div>

            <div class="row">
              <button class="btn primary" id="driveSignIn" type="button">Sign in with Google</button>
              <button class="btn" id="drivePull" type="button">Pull from Drive</button>
              <button class="btn" id="drivePush" type="button">Save to Drive</button>
              <div class="badge"><span>‚òÅÔ∏è</span><span id="driveStatus">Not signed in</span></div>
            </div>

            <div class="row">
              <div class="field">
                <label for="driveAuto">Auto-save to Drive</label>
                <select id="driveAuto">
                  <option value="0">Off</option>
                  <option value="1">Every 1 minute</option>
                  <option value="5" selected>Every 5 minutes</option>
                  <option value="10">Every 10 minutes</option>
                  <option value="15">Every 15 minutes</option>
                </select>
              </div>

              <div class="field">
                <label for="googleClientId">Google OAuth Client ID</label>
                <input id="googleClientId" type="text" placeholder="Paste your OAuth Client ID here" />
              </div>
            </div>

            <div class="row">
              <div class="field grow">
                <label for="googleApiKey">Google API key (optional)</label>
                <input id="googleApiKey" type="text" placeholder="Optional (only needed for some setups)" />
              </div>
            </div>

            <div class="notice" id="driveHint"></div>
          </details>
        </section>
      </div>
    </section>

    <!-- HISTORY -->
    <section class="tab" id="tab-history">
      <div class="grid">
        <section class="card col-12">
          <h2>History (latest 50)</h2>
          <div class="list" id="history"></div>
        </section>
      </div>
    </section>
  </main>

  <!-- End Session modal -->
  <div class="modalOverlay" id="endOverlay" aria-hidden="true">
    <div class="modal" role="dialog" aria-modal="true" aria-labelledby="endTitle">
      <h3 id="endTitle">Log this session</h3>
      <div class="notice">Minutes captured: <strong id="endMinsAuto">‚Äî</strong></div>

      <div class="formGrid">
        <div class="field">
          <label for="endFromPage">From page</label>
          <input id="endFromPage" inputmode="numeric" />
        </div>
        <div class="field">
          <label for="endToPage">Last page read (required)</label>
          <input id="endToPage" inputmode="numeric" />
        </div>
        <div class="field">
          <label for="endMins">Minutes (edit if needed)</label>
          <input id="endMins" inputmode="numeric" />
        </div>
      </div>

      <div class="modalActions">
        <button class="btn primary" id="endSave" type="button">Save session</button>
        <button class="btn" id="endCancel" type="button">Cancel</button>
      </div>

      <hr class="sep" />

      <div class="row">
        <button class="btn" id="editLast" type="button">Edit last session</button>
        <button class="btn danger" id="deleteLast" type="button">Delete last session</button>
      </div>
      <div class="notice" id="endMsg"></div>
    </div>
  </div>

  <div class="toast" id="toast" role="status" aria-live="polite"></div>

  <script src="https://accounts.google.com/gsi/client" async defer></script>
  <script src="https://apis.google.com/js/api.js" async defer></script>
  <script src="./app.js"></script>
</body>
</html>
